<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Alice - Past Simple Quiz</title>
  <style>
    #confetti-canvas {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      z-index: 1001;
      pointer-events: none;
    }
    body {
      font-family: 'Inter', system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: #f7f8fb;
      color: #1f2937;
      padding: 20px;
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
    }
    .card {
      background: white;
      border-radius: 16px;
      padding: 30px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
      max-width: 900px;
      width: 100%;
      box-sizing: border-box;
      position: relative;
      border: 1px solid #e5e7eb;
    }
    h1 {
      font-size: 24px;
      margin-bottom: 8px;
      color: #1f2937;
      text-align: center;
    }
    p.lead {
      color: #4b5563;
      margin-top: 0;
      margin-bottom: 20px;
      text-align: center;
      line-height: 1.5;
      font-size: 16px;
    }
    ol {
      padding-left: 24px;
      margin: 0;
    }
    li {
      margin: 14px 0;
      line-height: 1.6;
      padding: 8px;
      border-radius: 8px;
      transition: background-color 0.3s;
    }
    li:hover {
      background-color: #f9fafb;
    }
    .line {
      display: flex;
      gap: 10px;
      align-items: center;
      flex-wrap: wrap;
    }
    .label {
      min-width: 36px;
      color: #6b7280;
      font-weight: 500;
    }
    input[type=text] {
      padding: 10px 12px;
      border: 2px solid #e5e7eb;
      border-radius: 10px;
      font-size: 15px;
      width: 220px;
      transition: all 0.3s;
    }
    input[type=text]:focus {
      outline: none;
      border-color: #93c5fd;
      box-shadow: 0 0 0 3px rgba(147, 197, 253, 0.3);
    }
    input.correct {
      border-color: #16a34a;
      background: #f0fdf4;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.2);
    }
    input.wrong {
      border-color: #dc2626;
      background: #fef2f2;
      box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.2);
    }
    input.empty {
      border-color: #f59e0b;
      background: #fffbeb;
      box-shadow: 0 0 0 3px rgba(245, 158, 11, 0.2);
    }
    .small {
      font-size: 14px;
      color: #6b7280;
      margin-left: 6px;
      font-style: italic;
    }
    .controls {
      margin-top: 24px;
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      justify-content: center;
    }
    button {
      padding: 12px 20px;
      border-radius: 10px;
      border: 0;
      background: #3b82f6;
      color: white;
      cursor: pointer;
      transition: all 0.2s;
      font-weight: 600;
      box-shadow: 0 4px 6px rgba(37, 99, 235, 0.2);
    }
    button:hover {
      opacity: 0.9;
      transform: translateY(-2px);
      box-shadow: 0 6px 8px rgba(37, 99, 235, 0.3);
    }
    button.secondary {
      background: #6b7280;
      box-shadow: 0 4px 6px rgba(108, 117, 125, 0.2);
    }
    button.ghost {
      background: transparent;
      color: #3b82f6;
      border: 2px solid #bfdbfe;
      box-shadow: none;
      display: none; /* Oculto inicialmente */
    }
    button.ghost:hover {
      background: #eff6ff;
    }
    .footer {
      margin-top: 16px;
      color: #6b7280;
      font-size: 14px;
      text-align: center;
    }
    .alert {
      background: #fef3c7;
      border: 2px solid #f59e0b;
      color: #92400e;
      padding: 14px;
      border-radius: 10px;
      margin-bottom: 20px;
      display: none;
      text-align: center;
      font-weight: 500;
    }
    .congratulations {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      color: white;
      animation: fadeIn 0.5s ease;
    }
    .incorrect-modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.85);
      z-index: 1000;
      justify-content: center;
      align-items: center;
      flex-direction: column;
      text-align: center;
      color: white;
      animation: fadeIn 0.5s ease;
    }
    .congratulations-content, .incorrect-content {
      background: white;
      padding: 35px;
      border-radius: 20px;
      max-width: 500px;
      color: #1f2937;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      animation: scaleIn 0.5s ease;
      text-align: center;
      position: relative;
      z-index: 1002;
    }
    .congratulations h2 {
      color: #16a34a;
      margin-top: 0;
      font-size: 28px;
      margin-bottom: 15px;
    }
    .incorrect-content h2 {
      color: #dc2626;
      margin-top: 0;
      font-size: 28px;
      margin-bottom: 15px;
    }
    .congratulations p, .incorrect-content p {
      font-size: 18px;
      margin-bottom: 20px;
      color: #4b5563;
    }
    .congratulations img, .incorrect-content img {
      max-width: 280px;
      margin: 20px auto;
      display: block;
      border-radius: 12px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }
    .close-congrats, .close-incorrect {
      margin-top: 20px;
      padding: 12px 24px;
      background: #3b82f6;
      color: white;
      border: none;
      border-radius: 10px;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }
    .close-congrats:hover, .close-incorrect:hover {
      background: #2563eb;
      transform: translateY(-2px);
    }
    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }
    @keyframes scaleIn {
      from { transform: scale(0.9); opacity: 0; }
      to { transform: scale(1); opacity: 1; }
    }
    @media(max-width: 768px) {
      input[type=text] {
        width: 160px;
      }
      .line {
        flex-direction: column;
        align-items: flex-start;
        gap: 6px;
      }
      .congratulations-content, .incorrect-content {
        margin: 20px;
        padding: 25px;
      }
      .congratulations img, .incorrect-content img {
        max-width: 220px;
      }
    }
    @media(max-width: 480px) {
      .card {
        padding: 20px;
      }
      input[type=text] {
        width: 100%;
      }
      .controls {
        flex-direction: column;
      }
      button {
        width: 100%;
      }
    }
  </style>
</head>
<body>
  <div class="card">
    <div class="alert" id="emptyFieldsAlert">
      ⚠️ Por favor, completa todos los campos antes de comprobar.
    </div>
    
    <h1>Completa con Past Simple (Alicia en el país de las maravillas)</h1>
    <p class="lead">Escribe la forma correcta en pasado simple. Si la respuesta es correcta se pondrá <strong>verde</strong>, si está mal se pondrá <strong>rojo</strong>.</p>

    <ol id="quiz">
      <li class="line"><span class="label">1.</span>Alice <input data-answer="sat" type="text" /> under a big tree. <span class="small">(sit)</span></li>
      <li class="line"><span class="label">2.</span>She <input data-answer="saw" type="text" /> a white rabbit. <span class="small">(see)</span></li>
      <li class="line"><span class="label">3.</span>The rabbit <input data-answer="ran" type="text" /> very fast. <span class="small">(run)</span></li>
      <li class="line"><span class="label">4.</span>Alice <input data-answer="followed" type="text" /> the rabbit. <span class="small">(follow)</span></li>
      <li class="line"><span class="label">5.</span>She <input data-answer="fell" type="text" /> into a deep hole. <span class="small">(fall)</span></li>
      <li class="line"><span class="label">6.</span>She <input data-answer="landed" type="text" /> in a strange room. <span class="small">(land)</span></li>
      <li class="line"><span class="label">7.</span>She <input data-answer="found" type="text" /> a small door. <span class="small">(find)</span></li>
      <li class="line"><span class="label">8.</span>She <input data-answer="drank" type="text" /> a magic potion. <span class="small">(drink)</span></li>
      <li class="line"><span class="label">9.</span>She <input data-answer="became" type="text" /> very small. <span class="small">(become)</span></li>
      <li class="line"><span class="label">10.</span>She <input data-answer="entered" type="text" /> the garden. <span class="small">(enter)</span></li>
      <li class="line"><span class="label">11.</span>She <input data-answer="met" type="text" /> a smiling cat. <span class="small">(meet)</span></li>
      <li class="line"><span class="label">12.</span>The cat <input data-answer="disappeared" type="text" /> suddenly. <span class="small">(disappear)</span></li>
      <li class="line"><span class="label">13.</span>Alice <input data-answer="walked" type="text" /> to a tea party. <span class="small">(walk)</span></li>
      <li class="line"><span class="label">14.</span>She <input data-answer="sat" type="text" /> with the Mad Hatter. <span class="small">(sit)</span></li>
      <li class="line"><span class="label">15.</span>They <input data-answer="talked" type="text" /> and <input data-answer="laughed" type="text" /> loudly. <span class="small">(talk / laugh)</span></li>
      <li class="line"><span class="label">16.</span>She <input data-answer="left" type="text" /> the party. <span class="small">(leave)</span></li>
      <li class="line"><span class="label">17.</span>She <input data-answer="played" type="text" /> with the Queen in the garden. <span class="small">(play)</span></li>
      <li class="line"><span class="label">18.</span>The Queen <input data-answer="shouted" type="text" /> angrily, "Off with her head!" <span class="small">(shout)</span></li>
      <li class="line"><span class="label">19.</span>Alice <input data-answer="ran" type="text" /> away quickly. <span class="small">(run)</span></li>
      <li class="line"><span class="label">20.</span>She <input data-answer="woke" type="text" /> up from her dream. <span class="small">(wake)</span></li>
    </ol>

    <div class="controls">
      <button id="check">Comprobar</button>
      <button id="showAnswers" class="ghost">Mostrar respuestas</button>
      <button id="reset" class="secondary">Reiniciar</button>
    </div>

    <p class="footer">Consejo: escribe una respuesta y presiona <strong>Comprobar</strong>. Las respuestas correctas se marcarán en verde.</p>
  </div>

  <!-- Modal para respuestas correctas -->
  <div class="congratulations" id="congratulations">
    <div class="congratulations-content">
      <h2>¡Felicidades! 🎉</h2>
      <p>Has completado todas las respuestas correctamente.</p>
      <img src="https://www.gifsanimados.org/data/media/932/alicia-en-el-pais-de-las-maravillas-imagen-animada-0085.gif" alt="Alicia feliz">
      <button class="close-congrats" id="closeCongrats">Continuar</button>
    </div>
  </div>

  <!-- Modal para respuestas incorrectas -->
  <div class="incorrect-modal" id="incorrectAnswers">
    <div class="incorrect-content">
      <h2>¡Oops! Hay respuestas incorrectas</h2>
      <p>Revisa las respuestas marcadas en rojo e inténtalo de nuevo.</p>
      <img src="https://64.media.tumblr.com/056298e9c30752819e1995e566aa515f/tumblr_nav5crJTNd1sp6e2vo1_400.gif" alt="Alicia triste">
      <button class="close-incorrect" id="closeIncorrect">Reintentar</button>
    </div>
  </div>

  <!-- Canvas para el efecto de confeti -->
  <canvas id="confetti-canvas"></canvas>

  <!-- Cargar la biblioteca de confeti -->
  <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>

  <script>
    const inputs = Array.from(document.querySelectorAll('input[data-answer]'));
    const alertBox = document.getElementById('emptyFieldsAlert');
    const congratsModal = document.getElementById('congratulations');
    const incorrectModal = document.getElementById('incorrectAnswers');
    const closeCongratsBtn = document.getElementById('closeCongrats');
    const closeIncorrectBtn = document.getElementById('closeIncorrect');
    const showAnswersBtn = document.getElementById('showAnswers');
    const checkBtn = document.getElementById('check');
    const resetBtn = document.getElementById('reset');
    
    // Variable para rastrear si ha habido intentos incorrectos
    let hasIncorrectAttempt = false;
    
    function normalize(s) {
      return (s || '').trim().toLowerCase();
    }

    // Función para verificar si hay campos vacíos
    function checkEmptyFields() {
      let hasEmpty = false;
      
      inputs.forEach(inp => {
        const value = normalize(inp.value);
        if (value === '') {
          inp.classList.add('empty');
          hasEmpty = true;
        } else {
          inp.classList.remove('empty');
        }
      });
      
      return hasEmpty;
    }

    function checkAll() {
      // Verificar campos vacíos
      if (checkEmptyFields()) {
        alertBox.style.display = 'block';
        return;
      } else {
        alertBox.style.display = 'none';
      }
      
      // Comprobar respuestas y contar correctas
      let correctCount = 0;
      let hasIncorrect = false;
      
      inputs.forEach(inp => {
        const expected = normalize(inp.dataset.answer);
        const value = normalize(inp.value);
        if (value === expected) {
          inp.classList.remove('wrong');
          inp.classList.add('correct');
          correctCount++;
        } else {
          inp.classList.remove('correct');
          inp.classList.add('wrong');
          hasIncorrect = true;
        }
      });
      
      // Si hay respuestas incorrectas, mostrar el botón "Mostrar respuestas"
      if (hasIncorrect) {
        hasIncorrectAttempt = true;
        showAnswersBtn.style.display = 'block';
        incorrectModal.style.display = 'flex';
      } else {
        // Si todas son correctas, mostrar felicitaciones
        congratsModal.style.display = 'flex';
        launchConfetti(); 
      }
    }

    checkBtn.addEventListener('click', () => {
      checkAll();
    });

    // show correct answers
    showAnswersBtn.addEventListener('click', () => {
      inputs.forEach(inp => {
        inp.value = inp.dataset.answer;
        inp.classList.remove('wrong', 'empty');
        inp.classList.add('correct');
      });
      alertBox.style.display = 'none';
      // Ocultar el modal de respuestas incorrectas si está visible
      incorrectModal.style.display = 'none';
    });

    // reset
    resetBtn.addEventListener('click', () => {
      inputs.forEach(inp => {
        inp.value = '';
        inp.classList.remove('correct', 'wrong', 'empty');
      });
      alertBox.style.display = 'none';
      congratsModal.style.display = 'none';
      incorrectModal.style.display = 'none';
      // Ocultar el botón "Mostrar respuestas" al reiniciar
      showAnswersBtn.style.display = 'none';
      hasIncorrectAttempt = false;
    });

    // remove coloring while typing
    inputs.forEach(i => {
      i.addEventListener('input', () => {
        i.classList.remove('correct', 'wrong', 'empty');
        alertBox.style.display = 'none';
      });
      i.addEventListener('keydown', (e) => {
        if (e.key === 'Enter') {
          checkAll();
        }
      });
    });

    // Función para lanzar confeti
    function launchConfetti() {
      const duration = 3 * 1000; // 3 segundos
      const animationEnd = Date.now() + duration;
      const defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 1001 };

      function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
      }

      const interval = setInterval(function() {
        const timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
          return clearInterval(interval);
        }

        const particleCount = 50 * (timeLeft / duration);
        
        // Lanzar confeti desde la izquierda
        confetti({
          ...defaults,
          particleCount,
          origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 }
        });
        
        // Lanzar confeti desde la derecha
        confetti({
          ...defaults,
          particleCount,
          origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 }
        });
      }, 250);
    }
    
    // Cerrar modal de felicitaciones
    closeCongratsBtn.addEventListener('click', () => {
      congratsModal.style.display = 'none';
    });
    
    // Cerrar modal de respuestas incorrectas
    closeIncorrectBtn.addEventListener('click', () => {
      incorrectModal.style.display = 'none';
    });
  </script>
</body>
</html>